<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.14.10/dist/shaka-player.ui.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/shaka-player@4.14.10/dist/controls.min.css" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            background: #000;
            font-family: monospace;
        }
        #videoPlayer {
            width: 100vw;
            height: 100vh;
            background: #000;
        }
        #debugPanel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            border: 1px solid #0f0;
            max-height: 200px;
            overflow-y: auto;
            pointer-events: none;
        }
        .error {
            color: #f00;
        }
        .success {
            color: #0f0;
        }
    </style>
</head>
<body>
    <video id="videoPlayer" autoplay controls style="width:100vw;height:100vh;"></video>
    <div id="debugPanel">Iniciando...</div>

    <script>
        const debugPanel = document.getElementById('debugPanel');
        
        function log(msg, type = 'info') {
            const line = document.createElement('div');
            line.className = type === 'error' ? 'error' : (type === 'success' ? 'success' : '');
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            debugPanel.appendChild(line);
            debugPanel.scrollTop = debugPanel.scrollHeight;
            console.log(msg);
        }

        async function initPlayer() {
            try {
                // 1. Verificar Shaka
                if (typeof shaka === 'undefined') {
                    log('‚ùå Shaka Player no carg√≥', 'error');
                    return;
                }
                log('‚úÖ Shaka Player cargado', 'success');

                // 2. Instalar polyfills
                shaka.polyfill.installAll();
                log('‚úÖ Polyfills instalados', 'success');

                // 3. Verificar soporte del navegador
                if (!shaka.Player.isBrowserSupported()) {
                    log('‚ùå Navegador no soporta DRM', 'error');
                    return;
                }
                log('‚úÖ Navegador compatible', 'success');

                // 4. Configuraci√≥n
                const video = document.getElementById('videoPlayer');
                const player = new shaka.Player(video);
                
                // 5. Configurar ClearKey
                const clearKeys = {
                    // key ID en hex : key en hex
                    '1c62a216a5fe423f959cb1ca02f62d83': '54f2fdc83c1da33cd9269bf21e08218c'
                };
                
                player.configure({
                    drm: { clearKeys: clearKeys }
                });
                log('‚úÖ DRM configurado con ClearKey', 'success');
                log(`üîë Key ID: 1c62a216...`, 'info');
                
                // 6. Eventos de error
                player.addEventListener('error', (e) => {
                    const error = e.detail;
                    log(`‚ùå Error ${error.code}: ${error.message}`, 'error');
                    if (error.data) {
                        log(`   Detalles: ${JSON.stringify(error.data)}`, 'error');
                    }
                });

                // 7. Cargar stream
                const manifestUri = 'https://d3kzwqwnq1f7tq.cloudfront.net/out/v1/25ca218d53194065bedf6d998ace462e/index.mpd';
                log(`üì° Cargando: ${manifestUri}`, 'info');
                
                await player.load(manifestUri);
                log('‚úÖ Stream cargado exitosamente!', 'success');
                
                // 8. Intentar reproducir
                await video.play();
                log('‚ñ∂Ô∏è Reproduciendo', 'success');

            } catch (error) {
                log(`‚ùå Error cr√≠tico: ${error.message}`, 'error');
                if (error.code) {
                    log(`   C√≥digo: ${error.code}`, 'error');
                }
            }
        }

        // Iniciar
        window.onload = initPlayer;
    </script>
</body>
</html>
